<!DOCTYPE html>
<html lang="en">
<head>
    <title>Occupancy Detection Dashboard</title>
    <style>
        body { font-family: Arial,serif; margin: 19px; }
        #container { display: flex; }
        #left-panel { flex: 3; margin-right: 20px; }
        #right-panel { flex: 1; padding: 10px; border: 1px solid #ccc; }
        img { width: 100%; margin-bottom: 20px; }
        .sensor-value { font-size: 18px; margin-bottom: 10px; }
    </style>
</head>

<body>
    <h1>Occupancy Detection Dashboard</h1>

    <div id="container">
        <div id="left-panel">
            <input type="range" min="0" max="{{ max_index }}" value="{{ min_index }}" id="timeline_slider" style="width: 100%;">
            <p>Current Time: <span id="current_time">--:--:--</span></p>

            <h2>PIR vs Occupancy</h2>
            <img id="pir_vs_occ" src="data:image/png;base64,{{ FULL_pir_vs_occ }}">

            <h2>Latency Timeline</h2>
            <img id="latency_timeline" src="data:image/png;base64,{{ FULL_latency_timeline }}">

            <h2>Mean Latency Comparison</h2>
            <img id="latency_comparison" src="data:image/png;base64,{{ FULL_latency_comparison }}">
        </div>

        <div id="right-panel">
            <h2>Sensor Values</h2>

            <div class="sensor-value">True Occupancy: <span id="true_count"></span></div>
            <div class="sensor-value">PIR S6: <span id="s6_pir"></span></div>
            <div class="sensor-value">PIR S7: <span id="s7_pir"></span></div>
            <div class="sensor-value">Avg Temp: <span id="avg_temp"></span></div>
            <div class="sensor-value">Avg Light: <span id="avg_light"></span></div>
            <div class="sensor-value">Avg Sound: <span id="avg_sound"></span></div>
            <div class="sensor-value">CO2: <span id="co2"></span></div>
        </div>
    </div>

<script>
    const slider = document.getElementById("timeline_slider");

    slider.oninput = function() {
        fetch(`/get_data?time=${slider.value}`)
            .then(r => r.json())
            .then(data => {
                // update text
                document.getElementById("current_time").textContent = data.current_time;
                document.getElementById("true_count").textContent = data.true_count;
                document.getElementById("s6_pir").textContent = data.s6_pir;
                document.getElementById("s7_pir").textContent = data.s7_pir;
                document.getElementById("avg_temp").textContent = data.avg_temp.toFixed(2);
                document.getElementById("avg_light").textContent = data.avg_light.toFixed(2);
                document.getElementById("avg_sound").textContent = data.avg_sound.toFixed(2);
                document.getElementById("co2").textContent = data.co2.toFixed(2);
            });
    };

    slider.oninput();
</script>

</body>
</html>
